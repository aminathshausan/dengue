date: 25/01/19

Changed priors as below: 
1. Took beta ~ exponential(rate),  rate = 1, 0.2 0.1 keeping other priors as 
        delta ~ exponential(0.2);
        std ~ exponential(1);
        gamma ~ exponential(0.2);
        kappa ~ exponential(0.2);
        eta_raw ~ normal(0,1);
        omega_raw ~ normal(0, 1);
         ////////////////////
        eta   = exp(9.9 + 1*eta_raw);     //this computes log(eta) ~ normal(9.9, 1) hence eta ~ lognormal(9.9,1)    
        omega = exp(9.2 + 1*omega_raw);
        
  gave error for ode at initial value 

2. Tried normal() priors for delta, std, kappa, gamma with other priors as lognormal as defined in #1.
         // delta ~ normal(0,20);
        // std ~ normal(0,5);
        // gamma ~ normal(0,20);
        // kappa ~ normal(0,20);
   many error for computing ode and sampling 
   
3. Tried reparametrising Exponential priors: 
//   delta = -(1/0.2)*log(delta_raw);  //this computes delta ~ Exponential(rate=0.2)
           //   std = -(1/1.0)*log(std_raw);
           //   gamma = -(1/0.2)*log(gamma_raw);
           //   kappa = -(1/0.2)*log(kappa_raw);
  with _raw parameters ~ uniform(0,1)
  Gave 95 div transitions with adapt_delta =0.95
  
So its better not reparametrise these using uniform(0,1) distribution

4. Refer "mymodel4" folder: 
checked the difference between prior predictive plots for the case when mean of likelihood is defined as log10(ode output).
this plot showed log10(viremia) trajectories in the range (-2, 4) while that for log(ode output) in the likelihood showed range (-2, 10), which is in the range for observed viremia. 

5. Refer "mymodel4" folder: 
Checked posterior predictive plot for the case with mean of likelihood as log10(ode output) for patient 1 data.

posterior plot did not predict observed viremia trend. So its better to stick with log(ode output) in the likelihood 

////////////////////////////////////////////////////////
date: 05/02/19
For hierarchical model took priors as: 
delta_j ~ exponential(lambda_delta), with lambda_delta ~ exponential(0.2)
kappa_j ~ exponential(lambda_kappa) with lambda_kappa ~exponential(0.2)
Other priors are kept fixed as above 

With two patients data there were 169. div transitions

///////////////////////////////////
date: 06/02/19

For hierarchical model took priors as: 
delta_j ~ normal(mu_delta, sigma_delta), with mu_delta ~ normal(0, 10) and sigma_delta ~ exponential(0.2)
kappa_j ~ normal(mu_kappa, sigma_kappa), with mu_kappa ~ normal(0, 10) and sigma_kappa ~ exponential(0.2)
Other priors are kept fixed as above 

With two patients data R session aborted
this is solved 
///////////////////////////////////////////
date: 06/02/19 
1. desktop
For hierarchical model took priors as: 
delta_j ~ exponential(1/lambda_delta), with lambda_delta ~ exponential(0.2)
kappa_j ~ exponential(1/lambda_kappa) with lambda_kappa ~exponential(0.2)
Other priors are kept fixed as above 
with J =4 it took 1hr 36mins with 30 div transitions 

2. desktop J=4 
delta_j = mu_delta + sigma_delta*delta_raw
delta_raw ~normal(0,1)
kappa_j = mu_kappa + sigma_kappa*kappa_raw
kappa_raw ~normal(0,1)

simulation did not finish within 1hr 25mins: gave 7 divergent transitions

3. on HPc J=4
with exponential priors as in #1. it took about 2hrs30mins but with 153 div. transitions
//////////////////////////////////////////////////
data: 13/02/19 - 14/02/2019
1. "myModel-fit_censored.stan" : code is modified to estimate initial virus concentration (V0)
2. "myModel-fit_censored_noPool.stan": estimates parameters delta, std, kappa, and V0 as patient specific but independently 
This is to ensure any patient variability in these parameters when V0 is added to the estimands. 
Simulation is performed for J=10 and using FeverDay as time span. Result is saved as "p1_to_p10_noPool_with_V0.RData" 
results show that: (a) assuming initial TIPs concentration =0 produced no TIPs not co--infected cells throughout infection. 
                  (b) 95% posterior credible interval for viremia trajectory is okay. 
                  (c) Probably additional vector to hold trajectory for co--infected cells is required for later comparisions 
                  (d)overlaid density plots for delta, kappa, shows bimodal distribution with wide variability
                  (e)overlaid density for std and V0 show unimodal with different peak sizes and some variability 
3. "MyModel_fit_hierarchical.stan": V0 is estimated patient specific with prior ~ normal(mu_V0, sigma_V0), mu_V0~normal(0,100), sigma_V0~normal(0,10). 
    All simulations with J=31 gave : 
    (a) 49 div. transitions with debug run 
    (b) removed remarametrising of eta, omega, and beta and moved them to model block with their lognormal distributions and 
         V0 ~  normal(mu_V0, sigma_V0) could not complete sampling as there is an error about max. numb. of iterations for the ODE
    (c) reparametrised eta, omega, beta as before and reparametrised V0 = mu_V0 + sigma_V0 * V0_raw, with V0_raw ~ normal(0,1).
       this made simulations v slow and many trajectories exceed max. treedepth
4. cluster data according to Secondory and Primary infections 
   (a) remove reparametrisation of V0 but use sigma_V0~ exponential(mean =10)
////////////////////////////////////////////
date : 18/02/19
1. for all patients in cluster 1: test at lyra took about 30mins 
2. Sent fit_model for all cluster 1 patients on lyra at about 9am (Monday): 
   estimating delta, std, kappa, and V0 as patient specific 
              others as group specific 
  job is killed as walltime of 10hrs is reached 
3. for J=30 on desktop: test took about 10mins.
\\\\\\\\\\\\\\\\\\\\\\\\
date: 19/02/19
1. cluster 1 data is sent again by increasing number of hrs 
